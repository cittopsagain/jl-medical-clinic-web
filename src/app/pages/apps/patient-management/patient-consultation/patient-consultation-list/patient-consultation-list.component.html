<mat-tab-group
  [selectedIndex]="selectedTabIndex"
  (selectedIndexChange)="selectedTabIndex = $event">
  <mat-tab label="List of Consultations & Follow-ups">
    <div class="example-container">
      <mat-card class="cardWithShadow">
        <mat-card-content>
          <div class="row">
            <div class="col-lg-6">
              <div class="d-flex gap-4">
                <button mat-flat-button *ngIf="status === ''" color="primary"
                        (click)="filterByStatus('')">All</button>
                <button mat-stroked-button *ngIf="status !== ''"
                        (click)="filterByStatus('')">All</button>

                <button mat-flat-button *ngIf="status === 'WAITING'" color="primary"
                        (click)="filterByStatus('WAITING')">Waiting</button>
                <button mat-stroked-button *ngIf="status !== 'WAITING'"
                        (click)="filterByStatus('WAITING')">Waiting</button>

                <button mat-flat-button *ngIf="status === 'IN_PROGRESS'" color="primary"
                        (click)="filterByStatus('IN_PROGRESS')">In Progress</button>
                <button mat-stroked-button *ngIf="status !== 'IN_PROGRESS'"
                        (click)="filterByStatus('IN_PROGRESS')">In Progress</button>

                <button mat-flat-button *ngIf="status === 'COMPLETED'" color="primary"
                        (click)="filterByStatus('COMPLETED')">Completed</button>
                <button mat-stroked-button *ngIf="status !== 'COMPLETED'"
                        (click)="filterByStatus('COMPLETED')">Completed</button>
              </div>
            </div>
            <div class="col-lg-6">
              <div class="row">
                <div class="col-4">
                  <mat-form-field appearance="outline" class="w-100">
                    <mat-label>Filter By</mat-label>
                    <mat-select #filterByInput [(ngModel)]="selectedFilterBy" (selectionChange)="getPatientConsultation()"
                                disableOptionCentering placeholder="Filter By">
                      @for (filter of filter; track filter) {
                        <mat-option [value]="filter.value">
                          {{ filter.name }}
                        </mat-option>
                      }
                    </mat-select>
                  </mat-form-field>
                </div>

                <div class="col">
                  <mat-form-field appearance="outline" class="w-100 hide-hint">
                    <mat-label>Search</mat-label>
                    <input
                      matInput
                      placeholder="Search..."
                      [(ngModel)]="searchQuery"
                      (keyup.enter)="applyFilter()"
                      #searchQueryInput
                    />
                  </mat-form-field>
                </div>
              </div>
            </div>
          </div>
          <div class="example-table-container responsive-table">
            <table mat-table [dataSource]="data" class="hover-table">
              <!-- # -->
              <ng-container matColumnDef="number">
                <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-16">
                  #
                </th>
                <td mat-cell *matCellDef="let row; let i = index">
                  {{ i + 1 }}
                </td>
              </ng-container>

              <!-- Consultation Id -->
              <ng-container matColumnDef="consultationId">
                <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-16">
                  Visit Id
                </th>
                <td mat-cell style="color: #1976d2; cursor: pointer;" *matCellDef="let row" class="visit-id-cell"
                    (click)="
                        selectedTabIndex=1;
                        setVisitId(row.consultationId);
                        this.disableEditConsultationFollowupTab = false;">
                  {{ row.consultationId }}
                </td>
              </ng-container>

              <!-- Patient Id -->
              <ng-container matColumnDef="patientId">
                <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-16">
                  Patient ID
                </th>
                <td mat-cell *matCellDef="let row">
                  {{ row.patientId }}
                </td>
              </ng-container>

              <!-- Visit Type -->
              <ng-container matColumnDef="visitType">
                <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-16">
                  Visit Type
                </th>
                <td mat-cell *matCellDef="let row">
                  {{ row.visitType }}
                </td>
              </ng-container>

              <!-- Patient Name -->
              <ng-container matColumnDef="patientName">
                <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-16">
                  Patient Name
                </th>
                <td mat-cell *matCellDef="let row">
                  {{ row.lastName }}, {{ row.firstName }} {{ row.middleName }}
                </td>
              </ng-container>

              <!-- Address -->
              <ng-container matColumnDef="address">
                <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-16">
                  Address
                </th>
                <td mat-cell *matCellDef="let row">
                  {{ row.address }}
                </td>
              </ng-container>

              <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-16">
                  Status
                </th>
                <td mat-cell *matCellDef="let row">
              <span class="p-x-8 p-y-4 f-w-500 rounded-pill f-s-12" [ngClass]="getStatusClass(row.status)">
                {{ row.status }}
              </span>
                </td>
              </ng-container>

              <!-- Action -->
              <ng-container matColumnDef="action">
                <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-16">
                  Action
                </th>
                <td mat-cell *matCellDef="let element">
                  <div class="d-flex align-items-center gap-8" *ngIf="element.visitType === 'Consultation' || element.visitType === 'Follow-up Checkup'">
                    <!-- Edit -->
                    <a
                      mat-icon-button
                      (click)="
                        selectedTabIndex=1;
                        setVisitId(element.consultationId);
                        this.disableEditConsultationFollowupTab = false;"
                      class="d-flex align-items-center justify-content-center"
                      [disabled]="element.markForConsultation == 1"
                    >
                      <i-tabler
                        [name]="element.status === 'Waiting' ?
                      'pencil' : (element.status === 'In Progress' || element.status === 'Completed') ? 'eye' : 'pencil'"
                        class="icon-18 d-flex align-items-center"
                      ></i-tabler>
                    </a>
                  </div>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
            </table>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </mat-tab>

  <mat-tab label="Edit Consultation/Follow-up {{ visitId }}" [disabled]="disableEditConsultationFollowupTab">
    <app-edit-patient-consultation ></app-edit-patient-consultation>
  </mat-tab>
</mat-tab-group>
