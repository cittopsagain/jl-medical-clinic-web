<mat-card>
  <mat-card-content>
    <div class="row justify-content-end">
      <div class="col-sm-4 text-right">
        <a routerLink="/apps/diagnosis/patient-diagnosis"
           (click)="showEditPatientVisit = false;"
           mat-flat-button class="bg-error text-white m-r-10">
          Back to Diagnosis & Records
        </a>
      </div>
    </div>
  </mat-card-content>
</mat-card>

<div class="row">
  <div class="col-6">
    <mat-card>
      <mat-card-header>
        <mat-card-title>Patient Information</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="row">
          <!-- Patient Id -->
          <div class="col-sm-6">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Patient Id</mat-label>
              <input matInput readonly placeholder="Patient Id" [value]="data?.patientId" name="patientId" />
            </mat-form-field>
          </div>

          <!-- Last Name -->
          <div class="col-sm-6">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Last Name</mat-label>
              <input matInput readonly placeholder="Last Name" value="{{ data?.lastName }}" name="lastName" />
            </mat-form-field>
          </div>
        </div>

        <div class="row">
          <!-- First Name -->
          <div class="col-sm-6">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>First Name</mat-label>
              <input matInput readonly placeholder="First Name" value="{{ data?.firstName }}" name="firstName" />
            </mat-form-field>
          </div>

          <!-- Middle Name -->
          <div class="col-sm-6">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Middle Name</mat-label>
              <input matInput readonly placeholder="Middle Name" value="{{ data?.middleName }}" name="middleName" />
            </mat-form-field>
          </div>
        </div>

        <div class="row">
          <!-- Birth Date -->
          <div class="col-sm-6">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Birth Date</mat-label>
              <input matInput readonly placeholder="Middle Name" value="{{ data?.birthDate | date: 'MM/dd/yyyy' }}" name="middleName" />
            </mat-form-field>
          </div>

          <!-- Address -->
          <div class="col-sm-6">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Address</mat-label>
              <input matInput readonly placeholder="Address" value="{{ data?.address }}" name="address" />
            </mat-form-field>
          </div>
        </div>

        <div class="row">
          <!-- Gender -->
          <div class="col-sm-6">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Gender</mat-label>
              <input matInput readonly placeholder="Gender" value="{{ data?.gender }}" name="sex" />
            </mat-form-field>
          </div>

          <!-- Contact Number -->
          <div class="col-sm-6">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Contact Number</mat-label>
              <input matInput readonly placeholder="Contact Number" value="{{ data?.contactNumber }}" name="sex" />
            </mat-form-field>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
  <div class="col">
    <mat-card>
      <mat-card-header>
        <mat-card-title>Vital Signs</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="row m-t-20">
          <!-- Weight -->
          <div class="col-lg-4">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Weight(kg)</mat-label>
              <input matInput readonly placeholder="Weight(kg)" value="{{ selectedPatientVisit?.weight }}" name="weight" />
            </mat-form-field>
          </div>

          <!-- Height -->
          <div class="col-lg-4">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Height(cm)</mat-label>
              <input matInput readonly placeholder="Height(cm)" value="{{ selectedPatientVisit?.height }}" name="height" />
            </mat-form-field>
          </div>

          <!-- Temperature -->
          <div class="col-lg-4">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Temperature</mat-label>
              <input matInput readonly placeholder="Temperature" value="{{ selectedPatientVisit?.temperature }}" name="temperature" />
            </mat-form-field>
          </div>

          <!-- Blood Pressure -->
          <div class="col-lg-4">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Blood Pressure</mat-label>
              <input matInput readonly placeholder="Blood Pressure" value="{{ selectedPatientVisit?.bloodPressure }}" name="bloodPressure" />
            </mat-form-field>
          </div>

          <!-- Heart Rate -->
          <div class="col-lg-4">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Heart Rate</mat-label>
              <input matInput readonly placeholder="Heart Rate" value="{{ selectedPatientVisit?.heartRate }}" name="heartRate" />
            </mat-form-field>
          </div>

          <!-- Oxygen Saturation -->
          <div class="col-lg-4">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Oxygen Saturation</mat-label>
              <input matInput readonly placeholder="Oxygen Saturation" value="{{ selectedPatientVisit?.oxygenSaturation }}" name="oxygenSaturation" />
            </mat-form-field>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>

<div class="row">
  <div class="col-6">
    <mat-card>
      <mat-card-header>
        <mat-card-title>Patient Visits</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div *ngIf="showEditPatientVisit">
          <div class="row">
            <!-- Visit Id -->
            <div class="col-12">
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Visit Id</mat-label>
                <input matInput readonly placeholder="Visit Id" name="visitId" value="{{ selectedPatientVisit?.visitId }}" />
              </mat-form-field>
            </div>

            <!-- Visit Date -->
            <div class="col-12">
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Visit Date</mat-label>
                <input matInput readonly placeholder="Visit Date" name="visitDate" value="{{ selectedPatientVisit?.visitDateTime | date: 'MM/dd/yyyy' }}" />
              </mat-form-field>
            </div>

            <!-- Patient Complaints/Notes -->
            <div class="col-12">
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Patient Complaints/Notes</mat-label>
                <textarea matInput readonly placeholder="Patient Complaints/Notes" name="patientComplaintsNotes" value="{{ selectedPatientVisit?.patientComplaintsNotes }}"></textarea>
              </mat-form-field>
            </div>

            <!-- Followup -->
            <div class="col-12">
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Follow-up</mat-label>
                <input matInput readonly placeholder="Follow-up" name="followUp" value="{{ selectedPatientVisit?.followup }}" />
              </mat-form-field>
            </div>

            <!-- Diagnosis -->
            <div class="col-12">
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Diagnosis</mat-label>
                <textarea matInput readonly placeholder="Diagnosis" name="diagnosis" value="{{ selectedPatientVisit?.diagnosis }}"></textarea>
              </mat-form-field>
            </div>

            <!-- Remarks -->
            <div class="col-12">
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Remarks</mat-label>
                <textarea matInput placeholder="Remarks" name="remarks" #remarksInput value="{{ selectedPatientVisit?.remarks }}"></textarea>
              </mat-form-field>
            </div>

            <div class="col-6 d-flex">
              <button mat-flat-button color="primary" class="w-100"
                      (click)="updatePatientRemarks(); showEditPatientVisit = false">
                Update Remarks
              </button>
            </div>
            <div class="col-6 d-flex">
              <button mat-flat-button color="primary" class="w-100" (click)="showEditPatientVisit = false">
                Back to Patient Visits
              </button>
            </div>
          </div>
        </div>

        <div class="example-table-container responsive-table" *ngIf="!showEditPatientVisit">
          <table mat-table [dataSource]="patientVisits" class="hover-table">
            <!-- Visit Id -->
            <ng-container matColumnDef="visitId">
              <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-16">
                Visit Id
              </th>
              <td mat-cell *matCellDef="let row">
                {{ row.visitId }}
              </td>
            </ng-container>

            <!-- Date Time Visit -->
            <ng-container matColumnDef="dateTimeVisit">
              <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-16">
                Visit Date
              </th>
              <td mat-cell *matCellDef="let row">
                {{ row.visitDateTime | date: 'MM/dd/yyyy' }}
              </td>
            </ng-container>

            <!-- Diagnosis -->
            <ng-container matColumnDef="diagnosis">
              <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-16">
                Diagnosis
              </th>
              <td mat-cell *matCellDef="let row">
                {{ row.diagnosis }}
                <h6 class="mat-subtitle-1 f-s-14 f-w-600 text-primary" *ngIf="row.remarks && row.remarks !== ''">
                  Remarks: {{ row.remarks }}
                </h6>
              </td>
            </ng-container>

            <!-- Action -->
            <ng-container matColumnDef="action">
              <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-16">
                Action
              </th>
              <td mat-cell *matCellDef="let row">
                <div class="d-flex align-items-center gap-8">
                  <!-- Print -->
                  <a
                    mat-icon-button
                    class="d-flex align-items-center justify-content-center"
                    (click)="printMedicalCertificate(row);">
                    <i-tabler
                      name="printer"
                      class="icon-18 d-flex align-items-center"
                    ></i-tabler>
                  </a>

                  <!-- Edit -->
                  <a
                    mat-icon-button
                    class="d-flex align-items-center justify-content-center"
                    (click)="showEditPatientVisit = true;"
                  >
                    <i-tabler
                      name="pencil"
                      class="icon-18 d-flex align-items-center"
                    ></i-tabler>
                  </a>
                </div>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="patientVisitsDisplayedColumns; sticky: true"></tr>
            <tr mat-row *matRowDef="let row; columns: patientVisitsDisplayedColumns; let i = index"
                (click)="onMedicalHistoryRowClick(i, row); $event.preventDefault();"></tr>
          </table>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
  <div class="col-6">
    <mat-card>
      <mat-card-header>
        <mat-card-title>Patient Prescriptions</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="example-table-container responsive-table">
          <table mat-table [dataSource]="selectedPatientPrescriptionsByVisit" class="hover-table">
            <!-- Visit Id -->
            <ng-container matColumnDef="visitId">
              <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-16">
                Visit Id
              </th>
              <td mat-cell *matCellDef="let row">
                {{ row.visitId }}
              </td>
            </ng-container>

            <!-- Date Time Visit -->
            <ng-container matColumnDef="productName">
              <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-16">
                Product Name
              </th>
              <td mat-cell *matCellDef="let row">
                <h6 class="mat-subtitle-1 f-s-14 f-w-600">
                  {{ row.brandName }}
                </h6>
                <span class="f-s-14 f-s-12">
              {{ row.productName }}
            </span>
              </td>
            </ng-container>

            <!-- Dosage -->
            <ng-container matColumnDef="dosage">
              <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-16">
                Dosage
              </th>
              <td mat-cell *matCellDef="let row">
                {{ row.dosage }}
              </td>
            </ng-container>

            <!-- Quantity -->
            <ng-container matColumnDef="qty">
              <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-16">
                Quantity
              </th>
              <td mat-cell *matCellDef="let row">
                {{ row.quantity }}
              </td>
            </ng-container>

            <!-- Unit -->
            <ng-container matColumnDef="unit">
              <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-16">
                Unit
              </th>
              <td mat-cell *matCellDef="let row">
                {{ row.unit | uppercase }}
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="patientPrescriptionsDisplayedColumns; sticky: true"></tr>
            <tr mat-row *matRowDef="let row; columns: patientPrescriptionsDisplayedColumns; let i = index"></tr>
          </table>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>
